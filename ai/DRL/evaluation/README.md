# DRL Evaluation Module

–ú–æ–¥—É–ª—å –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –∏ –±–µ–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ DRL –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### üî¨ DRLBacktester
–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –±–µ–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ –æ–±—É—á–µ–Ω–Ω—ã—Ö DRL –∞–≥–µ–Ω—Ç–æ–≤:
- –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å—á–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–≤—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ (Buy & Hold)
- –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### üìä BacktestVisualizer  
–°–∏—Å—Ç–µ–º–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±–µ–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞:
- –ì—Ä–∞—Ñ–∏–∫–∏ —ç–≤–æ–ª—é—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥
- –î–∞—à–±–æ—Ä–¥ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **Total Return** - –æ–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- **Sharpe Ratio** - —Ä–∏—Å–∫-—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- **Alpha** - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –Ω–∞–¥ Buy & Hold
- **Volatility** - –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
- **Maximum Drawdown** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞

### üíº –¢–æ—Ä–≥–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- **Win Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
- **Profit Factor** - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –∫ —É–±—ã—Ç–∫–∞–º
- **Average Trade Return** - —Å—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∫–∏
- **Total Trades** - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫

### üéØ –ù–∞–≥—Ä–∞–¥—ã
- **Total Reward** - —Å—É–º–º–∞—Ä–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∞–≥–µ–Ω—Ç–∞
- **Mean Reward** - —Å—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ —à–∞–≥
- **Reward Distribution** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥

## –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from CryptoTrade.ai.DRL.evaluation import run_quick_backtest
from CryptoTrade.ai.DRL.agents import PPOAgent
from CryptoTrade.ai.DRL.config import TradingConfig

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = TradingConfig(
    symbol="BTCUSDT",
    timeframe="1d",
    initial_balance=100000
)

# –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—É—á–µ–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
agent = PPOAgent(drl_config, config)
agent.load("path/to/trained/model.zip")

# –ë—ã—Å—Ç—Ä—ã–π –±–µ–∫—Ç–µ—Å—Ç
results = run_quick_backtest(agent, config)

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
print(f"–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {results['performance']['total_return_pct']:.2f}%")
```

## –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from CryptoTrade.ai.DRL.evaluation import DRLBacktester, BacktestVisualizer

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –±–µ–∫—Ç–µ—Å—Ç–µ—Ä–∞
backtester = DRLBacktester(agent, config)

# –ü–æ–ª–Ω—ã–π –±–µ–∫—Ç–µ—Å—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
results = backtester.run_backtest(
    start_date="2023-01-01",
    end_date="2023-12-31", 
    deterministic=True,
    save_results=True
)

# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
backtester.print_results()

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π
visualizer = BacktestVisualizer()
dashboard_path = visualizer.create_summary_dashboard(results)
report_path = visualizer.create_comprehensive_report(results, episode_data)
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
{
    'metadata': {
        'agent_type': 'PPOAgent',
        'symbol': 'BTCUSDT',
        'timeframe': '1d',
        'total_steps': 1000,
        'execution_time_seconds': 45.2
    },
    'performance': {
        'total_return_pct': 15.34,
        'sharpe_ratio': 1.23,
        'max_drawdown_pct': -8.45,
        'buy_hold_return_pct': 12.67,
        'alpha': 0.0267
    },
    'trading': {
        'total_trades': 45,
        'win_rate': 0.67,
        'profit_factor': 1.89,
        'avg_winning_trade': 2.34,
        'avg_losing_trade': -1.23
    },
    'rewards': {
        'total_reward': 156.78,
        'mean_reward': 0.157,
        'std_reward': 0.045
    },
    'summary': {
        'success': True,
        'total_return_pct': 15.34,
        'vs_buy_hold': 2.67,
        'sharpe_ratio': 1.23
    }
}
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤

```python
# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—É—á–µ–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
agents = [ppo_agent, sac_agent, dqn_agent]
comparison_results = []

for agent in agents:
    results = run_quick_backtest(agent, config)
    comparison_results.append({
        'name': agent.__class__.__name__,
        'return': results['performance']['total_return_pct'],
        'sharpe': results['performance']['sharpe_ratio']
    })

# –ù–∞–π—Ç–∏ –ª—É—á—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞
best_agent = max(comparison_results, key=lambda x: x['sharpe'])
```

## –°–æ–∑–¥–∞–Ω–∏–µ custom –º–µ—Ç—Ä–∏–∫

```python
class CustomBacktester(DRLBacktester):
    def _analyze_results(self, episode_results):
        # –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
        analysis = super()._analyze_results(episode_results)
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        analysis['custom_metrics'] = {
            'my_metric': self._calculate_my_metric(episode_results),
            'risk_adjusted_return': analysis['performance']['total_return'] / analysis['performance']['volatility']
        }
        
        return analysis
```

## –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
- `CryptoTrade/ai/DRL/evaluation/results/` - JSON —Ñ–∞–π–ª—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- –ì—Ä–∞—Ñ–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–æ–¥–ø–∞–ø–∫–∏ —Å timestamp

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python 3.8+**
- **NumPy** - –¥–ª—è —á–∏—Å–ª–µ–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- **Pandas** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏  
- **Matplotlib** - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- **Seaborn** - –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ó–∞–ø—É—Å—Ç–∏—Ç–µ `example_usage.py` –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –º–æ–¥—É–ª—è:

```bash
python CryptoTrade/ai/DRL/evaluation/example_usage.py
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

–ú–æ–¥—É–ª—å –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:
- –ù–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π
- –°—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
- –≠–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ out-of-sample –¥–∞–Ω–Ω—ã–µ** –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Å –±–∞–∑–æ–≤—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏** –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏
3. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å**, –Ω–æ –∏ —Ä–∏—Å–∫–∏ (–ø—Ä–æ—Å–∞–¥–∫–∞, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–∞—Ö** –∏ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
5. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è