# STAS_ML - Модуль машинного обучения для торговли криптовалютами

## Описание

STAS_ML - это простой и эффективный модуль машинного обучения для прогнозирования цен криптовалют и генерации торговых сигналов. Модуль использует исторические данные BTCUSDT и технические индикаторы для обучения различных ML моделей.

## Структура модуля

```
STAS_ML/
├── config/                 # Конфигурация
│   ├── __init__.py
│   └── ml_config.py       # Настройки ML моделей
├── data/                  # Обработка данных
│   ├── __init__.py
│   └── data_processor.py  # Подготовка данных и признаков
├── models/                # ML модели
│   ├── __init__.py
│   └── predictor.py       # Основные модели (XGBoost, RF, LSTM, Linear)
├── training/              # Обучение
│   ├── __init__.py
│   └── trainer.py         # Тренер моделей
├── evaluation/            # Оценка
│   ├── __init__.py
│   └── evaluator.py       # Метрики и визуализация
├── mvp_train_ml.py        # Главный скрипт для обучения
└── README.md              # Этот файл
```

## Поддерживаемые модели

1. **XGBoost** (рекомендуется) - Gradient boosting для высокой точности
2. **Random Forest** - Ансамбль деревьев решений
3. **LSTM** - Рекуррентная нейронная сеть для временных рядов
4. **Linear Regression** - Простая линейная модель

## Типы предсказаний

1. **Направление движения** (`direction`) - Классификация вверх/вниз
2. **Изменение цены** (`price_change`) - Регрессия процентного изменения
3. **Волатильность** (`volatility`) - Предсказание волатильности

## Быстрый старт

### 1. Автоматическое обучение (рекомендуется)

```bash
python mvp_train_ml.py --auto
```

Это запустит обучение XGBoost модели на данных BTCUSDT 1d для предсказания направления движения.

### 2. Интерактивное обучение

```bash
python mvp_train_ml.py
```

Программа проведет вас через настройки:
- Выбор торговой пары
- Выбор таймфрейма  
- Выбор типа модели
- Выбор целевой переменной

### 3. Обучение с параметрами

```bash
python mvp_train_ml.py --auto --symbol ETHUSDT --model random_forest --target price_change
```

## Технические индикаторы

Модуль автоматически вычисляет следующие индикаторы:

- **Скользящие средние**: SMA, EMA
- **Осцилляторы**: RSI, Stochastic
- **Трендовые**: MACD
- **Волатильность**: Bollinger Bands, ATR
- **Объемные**: OBV
- **Дополнительные**: price_change, volume_change, high_low_ratio

## Конфигурация

Основные параметры в `MLConfig`:

```python
config = MLConfig(
    symbol='BTCUSDT',           # Торговая пара
    timeframe='1d',             # Таймфрейм
    model_type='xgboost',       # Тип модели
    target_type='direction',    # Что предсказывать
    lookback_window=30,         # Окно истории (периоды)
    train_split=0.7,            # Доля обучающих данных
    validation_split=0.15,      # Доля валидационных данных
    test_split=0.15             # Доля тестовых данных
)
```

## Результаты обучения

После обучения создаются:

1. **Модель**: `ml_models/{experiment_name}_model.joblib`
2. **Логи**: `logs/ml/{experiment_name}/`
   - `config.json` - Конфигурация эксперимента
   - `metrics.json` - Метрики модели
   - `report.txt` - Текстовый отчет
   - `evaluation_report.txt` - Детальная оценка

## Метрики оценки

### Для классификации (direction):
- Accuracy - Точность
- Precision - Точность положительных предсказаний
- Recall - Полнота
- F1-score - Гармоническое среднее precision и recall
- ROC AUC - Площадь под ROC кривой

### Для регрессии (price_change, volatility):
- MSE - Среднеквадратичная ошибка
- RMSE - Корень из MSE
- MAE - Средняя абсолютная ошибка
- R² - Коэффициент детерминации
- MAPE - Средняя абсолютная процентная ошибка
- Direction Accuracy - Точность направления движения

## Требования

### Обязательные:
```bash
pip install pandas numpy scikit-learn TA-Lib matplotlib seaborn
```

### Опциональные:
```bash
pip install xgboost    # Для XGBoost моделей
pip install torch      # Для LSTM моделей
```

## Примеры использования

### Программное использование

```python
from CryptoTrade.ai.STAS_ML import MLConfig, MLTrainer

# Создание конфигурации
config = MLConfig(
    symbol='BTCUSDT',
    timeframe='1d',
    model_type='xgboost',
    target_type='direction'
)

# Обучение модели
trainer = MLTrainer(config)
metrics = trainer.train()

# Кросс-валидация
cv_results = trainer.cross_validate()
```

### Загрузка обученной модели

```python
from CryptoTrade.ai.STAS_ML import CryptoPricePredictor, MLConfig

# Загрузка модели
config = MLConfig()  # Загрузится из сохраненной конфигурации
predictor = CryptoPricePredictor(config)
predictor.load('ml_models/BTCUSDT_1d_xgboost_direction_model.joblib')

# Предсказание
predictions = predictor.predict(X_new)
```

## Торговая симуляция

Модуль включает простую торговую симуляцию для оценки потенциальной прибыльности:

- Начальный баланс: $10,000
- Стратегия: Покупка при предсказании роста, продажа при предсказании падения
- Метрики: Общая доходность, Sharpe ratio, максимальная просадка

## Советы по использованию

1. **Начните с XGBoost** - обычно дает лучшие результаты
2. **Используйте направление движения** для торговых сигналов
3. **Дневной таймфрейм** более стабилен для обучения
4. **Проводите кросс-валидацию** для проверки стабильности модели
5. **Следите за переобучением** - валидационные метрики должны быть близки к обучающим

## Ограничения

- Модели обучаются только на исторических данных
- Не учитывают фундаментальные факторы
- Требуют регулярного переобучения
- Результаты не гарантируют прибыль в реальной торговле

## Поддержка

Для вопросов и предложений обращайтесь к разработчикам проекта STAS.